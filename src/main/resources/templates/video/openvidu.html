<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenVidu Video Call</title>
    <script src="https://unpkg.com/openvidu-browser"></script>
</head>

<body>
    <div id="video-container"></div>
    <button id="start-call">Start Call</button>
    <script>
        const OPENVIDU_SERVER_URL = 'https://localhost:4443';
        const OPENVIDU_SERVER_SECRET = 'echosecret';
        let OV, session;

        document.getElementById('start-call').addEventListener('click', () => {
            OV = new OpenVidu();
            session = OV.initSession();

            session.on('streamCreated', event => {
                session.subscribe(event.stream, 'video-container');
            });

            fetch('/api/sessions/create', { method: 'POST' })
                .then(response => response.json())
                .then(sessionResponse => {
                    const sessionId = sessionResponse.id;
                    return fetch(`/api/sessions/generate-token?sessionId=${sessionId}`, { method: 'POST' });
                })
                .then(response => response.json())
                .then(tokenResponse => {
                    const token = tokenResponse.token;
                    return session.connect(token);
                })
                .then(() => {
                    const publisher = OV.initPublisher('video-container');
                    session.publish(publisher);
                })
                .catch(error => console.error('Error connecting to session', error));
        });
    </script>
</body>

</html>